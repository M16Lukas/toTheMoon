<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.2.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

<security:http auto-config="true" use-expressions="true">
	<security:access-denied-handler error-page="/"/>

	<!-- login -->
	<security:form-login 
		login-page="/member/login"
		username-parameter="email"
		password-parameter="pw"
		authentication-failure-forward-url="/member/login?error=true"
		authentication-success-handler-ref="CustomAuthenticationSuccessHandler"
	/>
	
	<!-- logout -->
	<security:logout 
		logout-url="/member/logout"
		success-handler-ref="logoutSuccessHandler"
		invalidate-session="true"
		delete-cookies="JSESSIONID,remember-me"
	/>

	
	<!-- 중복 로그인 방지 -->
	<security:session-management invalid-session-url="/member/login">
		<security:concurrency-control max-sessions="1" expired-url="/member/login"/>
	</security:session-management>
	
	
	<security:csrf disabled="true"/>
</security:http>

<!-- provider --> 
<security:authentication-manager>

</security:authentication-manager>



<!-- 로그인 성공 시 처리 -->
<bean id="CustomAuthenticationSuccessHandler" class="com.theMoon.moon.security.CustomAuthenticationSuccessHandler">
	<property name="defaultUrl" value="/"/>
</bean>

<!-- 로그아웃 성공 시 referer 페이지로 이동 -->
<bean id="logoutSuccessHandler" class="org.springframework.security.web.authentication.logout.SimpleUrlLogoutSuccessHandler">
    <property name="useReferer" value="true"/>
</bean>

<!-- 비밀번호 암호화 -->
<bean id="passwordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>

</beans>
